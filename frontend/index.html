<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–±–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π</title>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º FontAwesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center; }
        h1 { color: #2e7d32; font-size: 2.5em; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.2em; }
        .content { display: grid; grid-template-columns: 250px 1fr; gap: 30px; }
        .sidebar { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .main-content { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .nav-btn { width: 100%; padding: 15px; margin-bottom: 10px; background: #f5f5f5; border: none; border-radius: 10px; text-align: left; font-size: 16px; cursor: pointer; transition: all 0.3s; }
        .nav-btn:hover { background: #2e7d32; color: white; transform: translateX(5px); }
        .nav-btn.active { background: #2e7d32; color: white; }
        .section { display: none; animation: fadeIn 0.5s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        h2 { color: #2e7d32; margin-bottom: 20px; border-bottom: 2px solid #2e7d32; padding-bottom: 10px; }
        h3 { color: #2e7d32; margin: 20px 0 10px 0; }
        .btn { padding: 12px 25px; background: #2e7d32; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; transition: background 0.3s; margin: 10px 0; }
        .btn:hover { background: #1b5e20; }
        .btn-primary { background: #2196F3; }
        .btn-primary:hover { background: #0b7dda; }
        .btn-secondary { background: #757575; }
        .btn-secondary:hover { background: #5a5a5a; }
        .btn-danger { background: #f44336; }
        .btn-danger:hover { background: #d32f2f; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #2e7d32; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .status { background: #4caf50; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.9em; }
        .error { color: #f44336; padding: 10px; background: #ffebee; border-radius: 5px; margin: 10px 0; }
        .success { color: #4caf50; padding: 10px; background: #e8f5e8; border-radius: 5px; margin: 10px 0; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .stat-label { font-size: 0.9em; opacity: 0.9; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ */
        .bulk-actions { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
            padding: 15px; 
            background: #f5f5f5; 
            border-radius: 10px; 
            align-items: center; 
            flex-wrap: wrap; 
        }
        .report-section { 
            margin: 25px 0; 
            padding: 20px; 
            background: #f9f9f9; 
            border-radius: 10px; 
            border-left: 4px solid #2e7d32; 
        }
        .report-stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 15px; 
            margin-top: 15px; 
        }
        .report-stats-grid .stat-card { 
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); 
        }
        .report-table { 
            margin-top: 15px; 
            background: white; 
        }
        .report-summary { 
            margin-top: 30px; 
            padding: 20px; 
            background: #e8f5e9; 
            border-radius: 10px; 
            border: 1px solid #c8e6c9; 
        }
        .export-buttons { 
            display: flex; 
            gap: 10px; 
            margin-top: 20px; 
            flex-wrap: wrap; 
        }
        .export-btn { 
            padding: 10px 20px; 
            background: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: background 0.3s; 
        }
        .export-btn:hover { 
            background: #388E3C; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.5); 
            justify-content: center; 
            align-items: center; 
        }
        .modal-content { 
            background: white; 
            border-radius: 15px; 
            width: 500px; 
            max-width: 90%; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            overflow: hidden; 
        }
        .modal-header { 
            padding: 20px; 
            background: #f44336; 
            color: white; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .modal-body { 
            padding: 25px; 
            text-align: center; 
        }
        .close-btn { 
            background: none; 
            border: none; 
            color: white; 
            font-size: 28px; 
            cursor: pointer; 
        }
        .warning-icon { 
            font-size: 60px; 
            color: #f44336; 
            margin-bottom: 15px; 
        }
        .product-name-warning { 
            margin: 15px 0; 
            padding: 15px; 
            background: #ffebee; 
            border-radius: 8px; 
            border-left: 4px solid #f44336; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ */
        .select-checkbox { 
            width: 18px; 
            height: 18px; 
            cursor: pointer; 
        }
        .selected-row { 
            background-color: #e3f2fd !important; 
        }
        .action-btn { 
            padding: 5px 10px; 
            margin: 0 3px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px; 
        }
        .edit-btn { 
            background: #2196F3; 
            color: white; 
        }
        .delete-btn { 
            background: #f44336; 
            color: white; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ */
        .export-section { 
            margin-top: 30px; 
            padding: 20px; 
            background: #f5f5f5; 
            border-radius: 10px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè≠ –ú–µ–±–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è "–≠–∫–æ–î–æ–º"</h1>
            <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º</p>
            <div class="status">‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ | üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: SQLite</div>
        </header>
        
        <div class="content">
            <div class="sidebar">
                <button class="nav-btn active" onclick="showSection('dashboard')">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
                <button class="nav-btn" onclick="showSection('products')">üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π</button>
                <button class="nav-btn" onclick="showSection('workshops')">üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ—Ö–∏</button>
                <button class="nav-btn" onclick="showSection('add-product')">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</button>
                <button class="nav-btn" onclick="showSection('reports')">üìà –û—Ç—á–µ—Ç—ã</button>
                <button class="nav-btn" onclick="showSection('advanced-reports')">üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</button>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                    <p style="font-size: 0.9em; color: #666;">¬© 2006-2025 –ú–µ–±–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è "–≠–∫–æ–î–æ–º"</p>
                    <p style="font-size: 0.8em; color: #999;">–í–µ—Ä—Å–∏—è 1.2.0</p>
                </div>
            </div>
            
            <div class="main-content">
                <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div id="dashboard" class="section active">
                    <h2>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                            <div class="stat-value" id="total-products">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ—Ö–æ–≤</div>
                            <div class="stat-value" id="total-workshops">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">–¢–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</div>
                            <div class="stat-value" id="total-types">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">–ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                            <div class="stat-value" id="total-materials">0</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h3>üéØ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                            <button class="btn" onclick="showSection('add-product')" style="width: 100%; margin-bottom: 10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</button>
                            <button class="btn" onclick="showSection('products')" style="width: 100%; margin-bottom: 10px;">üì¶ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏</button>
                            <button class="btn" onclick="showSection('workshops')" style="width: 100%;">üè≠ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ—Ö–∞–º–∏</button>
                        </div>
                        
                        <div>
                            <h3>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h3>
                            <div id="recent-products"></div>
                        </div>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π -->
                <div id="products" class="section">
                    <h2>üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π</h2>
                    <div id="bulk-actions" class="bulk-actions" style="display: none;">
                        <div>
                            <input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this)">
                            <label for="select-all-checkbox" style="margin-left: 8px;">
                                –í—ã–±—Ä–∞—Ç—å –≤—Å–µ (<span id="selected-count">0</span>)
                            </label>
                        </div>
                        <button class="btn btn-danger" onclick="deleteSelectedProducts()">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                        </button>
                        <button class="btn btn-secondary" onclick="clearSelection()">
                            <i class="fas fa-times"></i> –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                        </button>
                    </div>
                    <button class="btn" onclick="loadProducts()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <div id="products-list"></div>
                </div>
                
                <!-- –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ—Ö–∏ -->
                <div id="workshops" class="section">
                    <h2>üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ—Ö–∏</h2>
                    <button class="btn" onclick="loadWorkshops()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <div id="workshops-list"></div>
                </div>
                
                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
                <div id="add-product" class="section">
                    <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</h2>
                    <form id="product-form" onsubmit="addProduct(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label><i class="fas fa-barcode"></i> –ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥—É–∫—Ç–∞ *</label>
                                <input type="text" id="article" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CHAIR-2024" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tag"></i> –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ *</label>
                                <input type="text" id="product-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç—É–ª –æ—Ñ–∏—Å–Ω—ã–π" required>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label><i class="fas fa-list"></i> –¢–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏ *</label>
                                <select id="product-type" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-tree"></i> –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª *</label>
                                <select id="material" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª...</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-money-bill-wave"></i> –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (—Ä—É–±.) *</label>
                            <input type="number" id="price" step="0.01" min="0" placeholder="0.00" required>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label><i class="fas fa-ruler"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä 1 (–¥–ª–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö) *</label>
                                <input type="number" id="param1" step="0.01" min="0.01" value="1.0" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-ruler-vertical"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä 2 (—à–∏—Ä–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö) *</label>
                                <input type="number" id="param2" step="0.01" min="0.01" value="1.0" required>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn" style="padding: 15px 40px; font-size: 18px;">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
                        </button>
                    </form>
                </div>
                
                <!-- –û—Ç—á–µ—Ç—ã -->
                <div id="reports" class="section">
                    <h2>üìà –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    <div class="export-section">
                        <h3><i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                        <div class="export-buttons">
                            <button class="export-btn" onclick="exportData('products')">
                                <i class="fas fa-file-excel"></i> –¢–æ–≤–∞—Ä—ã (Excel)
                            </button>
                            <button class="export-btn" onclick="exportData('workshops')">
                                <i class="fas fa-file-excel"></i> –¶–µ—Ö–∏ (Excel)
                            </button>
                            <button class="export-btn" onclick="exportData('materials')">
                                <i class="fas fa-file-excel"></i> –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (Excel)
                            </button>
                            <button class="export-btn" onclick="exportData('full')">
                                <i class="fas fa-file-alt"></i> –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç (CSV)
                            </button>
                        </div>
                    </div>
                    <div id="reports-content">
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤...</p>
                    </div>
                </div>
                
                <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã -->
                <div id="advanced-reports" class="section">
                    <h2><i class="fas fa-chart-line"></i> –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</h2>
                    
                    <div class="bulk-actions">
                        <button class="btn btn-primary" onclick="generateDailyReport()">
                            <i class="fas fa-calendar-day"></i> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç
                        </button>
                        <button class="btn btn-primary" onclick="generateMonthlyReport()">
                            <i class="fas fa-calendar-alt"></i> –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç
                        </button>
                        <button class="btn btn-primary" onclick="generateFinancialReport()">
                            <i class="fas fa-money-bill-wave"></i> –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç
                        </button>
                    </div>
                    
                    <div class="report-section">
                        <h3><i class="fas fa-chart-pie"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h3>
                        <div id="type-statistics" class="report-stats-grid"></div>
                    </div>
                    
                    <div class="report-section">
                        <h3><i class="fas fa-tree"></i> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h3>
                        <div id="material-statistics" class="report-stats-grid"></div>
                    </div>
                    
                    <div class="report-section">
                        <h3><i class="fas fa-industry"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ—Ö–æ–≤</h3>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>–¶–µ—Ö</th>
                                    <th>–†–∞–±–æ—Ç–Ω–∏–∫–æ–≤</th>
                                    <th>–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</th>
                                    <th>–¢–µ–∫—É—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</th>
                                    <th>–ö–æ–ª-–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</th>
                                </tr>
                            </thead>
                            <tbody id="workshop-load-table">
                                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-summary">
                        <h4><i class="fas fa-file-signature"></i> –†–µ–∑—é–º–µ –æ—Ç—á–µ—Ç–∞</h4>
                        <div id="report-summary-content">
                            <p>–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: <span id="report-date"></span></p>
                            <p>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: <span id="total-report-items">0</span></p>
                            <p>–ü–µ—Ä–∏–æ–¥: <span id="report-period">–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</span></p>
                        </div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="export-btn" onclick="printReport()">
                            <i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å –æ—Ç—á–µ—Ç–∞
                        </button>
                        <button class="export-btn" onclick="saveReportAsPDF()">
                            <i class="fas fa-file-pdf"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ PDF
                        </button>
                        <button class="export-btn" onclick="emailReport()">
                            <i class="fas fa-envelope"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="delete-confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                <button class="close-btn" onclick="closeDeleteConfirm()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h4>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?</h4>
                <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
                
                <div class="product-name-warning">
                    <i class="fas fa-box"></i>
                    <strong>–¢–æ–≤–∞—Ä:</strong> <span id="delete-product-name"></span>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="closeDeleteConfirm()" style="margin-right: 10px;">
                        <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                    </button>
                    <button id="confirm-delete-btn" class="btn btn-danger">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let allProducts = [];
        let selectedProducts = new Set();
        let productToDelete = null;
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞
            switch(sectionId) {
                case 'dashboard': loadDashboard(); break;
                case 'products': loadProducts(); break;
                case 'workshops': loadWorkshops(); break;
                case 'add-product': loadFormData(); break;
                case 'reports': loadReports(); break;
                case 'advanced-reports': loadAdvancedReports(); break;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        async function loadDashboard() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                const [productsRes, workshopsRes, typesRes, materialsRes] = await Promise.all([
                    fetch(`${API_URL}/products`),
                    fetch(`${API_URL}/workshops`),
                    fetch(`${API_URL}/product-types`),
                    fetch(`${API_URL}/materials`)
                ]);
                
                const products = await productsRes.json();
                const workshops = await workshopsRes.json();
                const types = await typesRes.json();
                const materials = await materialsRes.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('total-products').textContent = products.count || 0;
                document.getElementById('total-workshops').textContent = workshops.count || 0;
                document.getElementById('total-types').textContent = types.count || 0;
                document.getElementById('total-materials').textContent = materials.count || 0;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã
                if (products.data && products.data.length > 0) {
                    let html = '<table><tr><th>–ê—Ä—Ç–∏–∫—É–ª</th><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th></tr>';
                    const recent = products.data.slice(0, 5);
                    recent.forEach(p => {
                        html += `<tr>
                            <td><strong>${p.article}</strong></td>
                            <td>${p.product_name}</td>
                            <td>${p.min_partner_price} ‚ÇΩ</td>
                        </tr>`;
                    });
                    html += '</table>';
                    document.getElementById('recent-products').innerHTML = html;
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
        async function loadProducts() {
            try {
                const response = await fetch(`${API_URL}/products`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    allProducts = data.data;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –º–∞—Å—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
                    document.getElementById('bulk-actions').style.display = 'flex';
                    
                    let html = '<table><tr><th><input type="checkbox" id="master-checkbox" onchange="toggleSelectAll(this)"></th><th>–ê—Ä—Ç–∏–∫—É–ª</th><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th><th>–¢–∏–ø</th><th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th><th>–¶–µ–Ω–∞</th><th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>';
                    
                    data.data.forEach((product, index) => {
                        const isSelected = selectedProducts.has(product.id);
                        html += `<tr class="${isSelected ? 'selected-row' : ''}">
                            <td><input type="checkbox" class="select-checkbox" value="${product.id}" onchange="toggleProductSelection(${product.id}, this)" ${isSelected ? 'checked' : ''}></td>
                            <td><strong>${product.article}</strong></td>
                            <td>${product.product_name}</td>
                            <td>${product.product_type_name || '‚Äî'}</td>
                            <td>${product.material_name || '‚Äî'}</td>
                            <td>${parseFloat(product.min_partner_price).toFixed(2)} ‚ÇΩ</td>
                            <td>${new Date(product.created_at).toLocaleDateString('ru-RU')}</td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editProduct(${product.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="confirmDeleteProduct(${product.id}, '${product.product_name}')" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>`;
                    });
                    
                    html += `</table><p class="success">‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: ${data.count}</p>`;
                    document.getElementById('products-list').innerHTML = html;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                    updateSelectedCount();
                } else {
                    document.getElementById('products-list').innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>';
                }
                
            } catch (error) {
                document.getElementById('products-list').innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }
        
        // –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        function toggleProductSelection(productId, checkbox) {
            if (checkbox.checked) {
                selectedProducts.add(productId);
            } else {
                selectedProducts.delete(productId);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Å—Ç—Ä–æ–∫–∏
            const row = checkbox.closest('tr');
            if (checkbox.checked) {
                row.classList.add('selected-row');
            } else {
                row.classList.remove('selected-row');
            }
            
            updateSelectedCount();
        }
        
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.select-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                const productId = parseInt(cb.value);
                
                if (checkbox.checked) {
                    selectedProducts.add(productId);
                    cb.closest('tr').classList.add('selected-row');
                } else {
                    selectedProducts.delete(productId);
                    cb.closest('tr').classList.remove('selected-row');
                }
            });
            
            updateSelectedCount();
        }
        
        function updateSelectedCount() {
            document.getElementById('selected-count').textContent = selectedProducts.size;
        }
        
        function clearSelection() {
            selectedProducts.clear();
            const checkboxes = document.querySelectorAll('.select-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = false;
                cb.closest('tr').classList.remove('selected-row');
            });
            updateSelectedCount();
        }
        
        async function deleteSelectedProducts() {
            if (selectedProducts.size === 0) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${selectedProducts.size} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤?`)) {
                return;
            }
            
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –≤—ã–∑–æ–≤ API –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
                // –ù–∞–ø—Ä–∏–º–µ—Ä: await fetch(`${API_URL}/products/bulk-delete`, { method: 'POST', body: JSON.stringify({ids: Array.from(selectedProducts)}) });
                
                // –ü–æ–∫–∞–∂–µ–º –∏–º–∏—Ç–∞—Ü–∏—é —É–¥–∞–ª–µ–Ω–∏—è
                alert(`‚úÖ –£–¥–∞–ª–µ–Ω–æ ${selectedProducts.size} –ø—Ä–æ–¥—É–∫—Ç–æ–≤`);
                selectedProducts.clear();
                loadProducts(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                loadDashboard(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${error.message}`);
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
        function confirmDeleteProduct(productId, productName) {
            productToDelete = productId;
            document.getElementById('delete-product-name').textContent = productName;
            document.getElementById('delete-confirm-modal').style.display = 'flex';
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
            const oldBtn = document.getElementById('confirm-delete-btn');
            const newBtn = oldBtn.cloneNode(true);
            oldBtn.parentNode.replaceChild(newBtn, oldBtn);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
            newBtn.addEventListener('click', deleteProduct);
        }
        
        function closeDeleteConfirm() {
            document.getElementById('delete-confirm-modal').style.display = 'none';
            productToDelete = null;
        }
        
        async function deleteProduct() {
            if (!productToDelete) return;
            
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –≤—ã–∑–æ–≤ API –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                // –ù–∞–ø—Ä–∏–º–µ—Ä: await fetch(`${API_URL}/products/${productToDelete}`, { method: 'DELETE' });
                
                alert('‚úÖ –ü—Ä–æ–¥—É–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                closeDeleteConfirm();
                loadProducts();
                loadDashboard();
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${error.message}`);
            }
        }
        
        function editProduct(productId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å ID: ${productId}\n(–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –æ—Ç–∫—Ä—ã–ª–∞—Å—å –±—ã —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)`);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ü–µ—Ö–æ–≤
        async function loadWorkshops() {
            try {
                const response = await fetch(`${API_URL}/workshops`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    let html = '<table><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ—Ö–∞</th><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</th><th>–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—á–∞—Å—ã)</th><th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th></tr>';
                    
                    data.data.forEach(workshop => {
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º "–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å" (—É—Å–ª–æ–≤–Ω–æ)
                        const productivity = Math.round((workshop.worker_count * 100) / workshop.processing_time);
                        const productivityClass = productivity > 150 ? 'status' : productivity > 100 ? '' : 'error';
                        
                        html += `<tr>
                            <td>üè≠ ${workshop.workshop_name}</td>
                            <td>${workshop.worker_count} —á–µ–ª.</td>
                            <td>${workshop.processing_time} —á</td>
                            <td><span class="${productivityClass}">${productivity}%</span></td>
                        </tr>`;
                    });
                    
                    html += `</table><p class="success">‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ü–µ—Ö–æ–≤: ${data.count}</p>`;
                    document.getElementById('workshops-list').innerHTML = html;
                }
                
            } catch (error) {
                document.getElementById('workshops-list').innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º—ã
        async function loadFormData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∏–ø—ã –ø—Ä–æ–¥—É–∫—Ü–∏–∏
                const typesResponse = await fetch(`${API_URL}/product-types`);
                const typesData = await typesResponse.json();
                const typeSelect = document.getElementById('product-type');
                typeSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>';
                if (typesData.data) {
                    typesData.data.forEach(type => {
                        typeSelect.innerHTML += `<option value="${type.id}">${type.type_name}</option>`;
                    });
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                const materialsResponse = await fetch(`${API_URL}/materials`);
                const materialsData = await materialsResponse.json();
                const materialSelect = document.getElementById('material');
                materialSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª...</option>';
                if (materialsData.data) {
                    materialsData.data.forEach(material => {
                        materialSelect.innerHTML += `<option value="${material.id}">${material.material_name}</option>`;
                    });
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã:', error);
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
        async function addProduct(event) {
            event.preventDefault();
            
            const productData = {
                article: document.getElementById('article').value,
                product_name: document.getElementById('product-name').value,
                product_type_id: parseInt(document.getElementById('product-type').value),
                main_material_id: parseInt(document.getElementById('material').value),
                min_partner_price: parseFloat(document.getElementById('price').value),
                param1: parseFloat(document.getElementById('param1').value),
                param2: parseFloat(document.getElementById('param2').value)
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!productData.article || !productData.product_name || productData.min_partner_price < 0) {
                alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ –ü—Ä–æ–¥—É–∫—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    document.getElementById('product-form').reset();
                    showSection('products');
                    loadProducts();
                    loadDashboard(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞: ${result.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
        async function loadReports() {
            try {
                const [productsRes, workshopsRes] = await Promise.all([
                    fetch(`${API_URL}/products`),
                    fetch(`${API_URL}/workshops`)
                ]);
                
                const products = await productsRes.json();
                const workshops = await workshopsRes.json();
                
                let html = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</h3>
                            <p>–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: <strong>${products.count || 0}</strong></p>
                            <p>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: <strong>${calculateAveragePrice(products.data)} ‚ÇΩ</strong></p>
                            <p>–°—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <strong>${calculateTotalPrice(products.data)} ‚ÇΩ</strong></p>
                        </div>
                        <div>
                            <h3>üè≠ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ—Ö–æ–≤</h3>
                            <p>–í—Å–µ–≥–æ —Ü–µ—Ö–æ–≤: <strong>${workshops.count || 0}</strong></p>
                            <p>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤: <strong>${calculateTotalWorkers(workshops.data)}</strong></p>
                            <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: <strong>${calculateAverageProcessingTime(workshops.data)} —á</strong></p>
                        </div>
                    </div>
                `;
                
                document.getElementById('reports-content').innerHTML = html;
            } catch (error) {
                document.getElementById('reports-content').innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–æ–≤: ${error.message}</p>`;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
        async function loadAdvancedReports() {
            try {
                const [productsRes, workshopsRes, typesRes, materialsRes] = await Promise.all([
                    fetch(`${API_URL}/products`),
                    fetch(`${API_URL}/workshops`),
                    fetch(`${API_URL}/product-types`),
                    fetch(`${API_URL}/materials`)
                ]);
                
                const products = await productsRes.json();
                const workshops = await workshopsRes.json();
                const types = await typesRes.json();
                const materials = await materialsRes.json();
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏
                let typeStatsHtml = '';
                if (types.data) {
                    types.data.forEach(type => {
                        const count = products.data ? products.data.filter(p => p.product_type_id === type.id).length : 0;
                        typeStatsHtml += `
                            <div class="stat-card">
                                <div class="stat-label">${type.type_name}</div>
                                <div class="stat-value">${count}</div>
                            </div>
                        `;
                    });
                }
                document.getElementById('type-statistics').innerHTML = typeStatsHtml;
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º
                let materialStatsHtml = '';
                if (materials.data) {
                    materials.data.forEach(material => {
                        const count = products.data ? products.data.filter(p => p.main_material_id === material.id).length : 0;
                        materialStatsHtml += `
                            <div class="stat-card">
                                <div class="stat-label">${material.material_name}</div>
                                <div class="stat-value">${count}</div>
                            </div>
                        `;
                    });
                }
                document.getElementById('material-statistics').innerHTML = materialStatsHtml;
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ—Ö–æ–≤
                let workshopTableHtml = '';
                if (workshops.data) {
                    workshops.data.forEach(workshop => {
                        const productCount = products.data ? products.data.filter(p => p.workshop_id === workshop.id).length : 0;
                        const loadPercentage = Math.min(100, Math.round((productCount / 10) * 100)); // –£—Å–ª–æ–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç
                        const loadClass = loadPercentage > 80 ? 'error' : loadPercentage > 60 ? '' : 'status';
                        
                        workshopTableHtml += `
                            <tr>
                                <td>${workshop.workshop_name}</td>
                                <td>${workshop.worker_count}</td>
                                <td>${workshop.processing_time} —á</td>
                                <td><span class="${loadClass}">${loadPercentage}%</span></td>
                                <td>${productCount}</td>
                            </tr>
                        `;
                    });
                }
                document.getElementById('workshop-load-table').innerHTML = workshopTableHtml;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—é–º–µ –æ—Ç—á–µ—Ç–∞
                document.getElementById('report-date').textContent = new Date().toLocaleString('ru-RU');
                document.getElementById('total-report-items').textContent = products.count || 0;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤:', error);
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
        function generateDailyReport() {
            document.getElementById('report-period').textContent = '–ó–∞ —Å–µ–≥–æ–¥–Ω—è';
            alert('üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
        }
        
        function generateMonthlyReport() {
            document.getElementById('report-period').textContent = '–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü';
            alert('üìÖ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
        }
        
        function generateFinancialReport() {
            document.getElementById('report-period').textContent = '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç';
            alert('üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData(type) {
            let fileName = '';
            let content = '';
            
            switch(type) {
                case 'products':
                    fileName = 'products_export.csv';
                    content = '–ê—Ä—Ç–∏–∫—É–ª,–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ,–¢–∏–ø,–ú–∞—Ç–µ—Ä–∏–∞–ª,–¶–µ–Ω–∞\n';
                    allProducts.forEach(p => {
                        content += `${p.article},${p.product_name},${p.product_type_name},${p.material_name},${p.min_partner_price}\n`;
                    });
                    break;
                case 'workshops':
                    fileName = 'workshops_export.csv';
                    content = '–¶–µ—Ö,–†–∞–±–æ—Ç–Ω–∏–∫–æ–≤,–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n';
                    // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ—Ö–æ–≤
                    break;
                case 'materials':
                    fileName = 'materials_export.csv';
                    content = '–ú–∞—Ç–µ—Ä–∏–∞–ª,–û–ø–∏—Å–∞–Ω–∏–µ\n';
                    // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                    break;
                case 'full':
                    fileName = 'full_report.csv';
                    content = '–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç\n–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ' + new Date().toLocaleString('ru-RU');
                    break;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
            
            alert(`‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª: ${fileName}`);
        }
        
        // –î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤
        function printReport() {
            window.print();
        }
        
        function saveReportAsPDF() {
            alert('üìÑ –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–∫ PDF (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ jsPDF)');
        }
        
        function emailReport() {
            alert('üìß –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ email (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ—á—Ç–æ–≤—ã–º —Å–µ—Ä–≤–∏—Å–æ–º)');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function calculateAveragePrice(products) {
            if (!products || products.length === 0) return '0.00';
            const sum = products.reduce((acc, p) => acc + parseFloat(p.min_partner_price), 0);
            return (sum / products.length).toFixed(2);
        }
        
        function calculateTotalPrice(products) {
            if (!products || products.length === 0) return '0.00';
            const sum = products.reduce((acc, p) => acc + parseFloat(p.min_partner_price), 0);
            return sum.toFixed(2);
        }
        
        function calculateTotalWorkers(workshops) {
            if (!workshops || workshops.length === 0) return 0;
            return workshops.reduce((acc, w) => acc + w.worker_count, 0);
        }
        
        function calculateAverageProcessingTime(workshops) {
            if (!workshops || workshops.length === 0) return '0.00';
            const sum = workshops.reduce((acc, w) => acc + w.processing_time, 0);
            return (sum / workshops.length).toFixed(2);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            loadDashboard();
            loadFormData();
        };
    </script>
</body>
</html>